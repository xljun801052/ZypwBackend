server:
  port: 12019
spring:
  application:
    name: gateway-service
  cloud:
    # 注册服务【如果不用配置中心的话，不要引入nacos-config依赖包,否则启动报错】
    nacos:
      discovery:
        server-addr: 127.0.0.1:8848
    # 配置gateway网关：https://docs.spring.io/spring-cloud-gateway/docs/current/reference/html/
    #     1、SpringCloud Gateway的路由转发必须是满足所有的predicates才可以算匹配成功，从而被转发。当然，相同的Predicate也可以配置多个
    # 参考文档：https://blog.csdn.net/weixin_44141495/article/details/110160186
    # 参考文档：https://www.jianshu.com/p/c8ac84e820cc
    gateway:
      discovery:
        locator:
          enabled: true
          # 设置serviceId大小，默认大写
          lower-case-service-id: true
      routes:
        # homepage-service路由转发配置
        - id: homepage-server
          # lb表示从注册中心获取服务
          uri: lb://homepage-service
          predicates:
            # 如果请求地址满足/homepage/**,则将请求转发到homepage-service服务
            - Path=/homepage/**
          # - Cookie=mycookie,mycookievalue # 暂时不用对cookie进行校验
          filters:
            # 去除原请求地址中从左往右的n级路径【n为StripPrefix配置的value值】
            - StripPrefix=1
            # 熔断降级过滤器回调处理配置
            - name: Hystrix
              args:
                name: homepage-fallback
                fallbackUri: forward:/homepage_fallback

        # onlinemarket-service路由转发配置
        - id: onlinemarket-server
          uri: lb://onlinemarket-service
          predicates:
            - Path=/onlinemarket/**
          filters:
            - StripPrefix=1
            - name: Hystrix
              args:
                name: onlinemarket-fallback
                fallbackUri: forward:/onlinemarket_fallback

        # 全局路由转发配置
        - id: gateway-server
          uri: lb://gateway-service
          predicates:
            # 设置对所有请求进行拦截从而进行token权限认证
            - Path=/{oldPath}
            # 进行请求头的token检测
            #- Header=Zypw-Token, \d+
          filters:
            - StripPrefix=1
            - name: Hystrix
              args:
                name: gateway-fallback
                fallbackUri: forward:/gateway_fallback


